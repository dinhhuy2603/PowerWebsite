@{
    ViewBag.Title = "Overview Page";
    //Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles
{
    <link rel="shortcut icon" href="~/Content/images/favicon.ico">

    <!-- App css -->
    <link href="~/Content/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bs-default-stylesheet" />
    <link href="~/Content/css/app.min.css" rel="stylesheet" type="text/css" id="app-default-stylesheet" />
    <link href="~/Content/css/common.css" rel="stylesheet" type="text/css" />
    <!-- icons -->
    <link href="~/Content/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/css/style.css" rel="stylesheet" type="text/css" />
}
<style>
    .table-total {
        color: #fff;
        text-align: center;
    }
            
    .table-total th {
        background: green;
    }
</style>
<!-- ============================================================== -->
<!-- Start Page Content here -->
<!-- ============================================================== -->

<div class="content-page pd-0-mobile">
    <div class="content">

        <!-- Start Content-->
        <div class="container-fluid pd-0-mobile">
            <div class="row mt-5">
                <div class="col-xl-6 col-md-6">
                    <div class="card bg-card">
                        <h5 class="card-header text-center font-20">GAS</h5>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0 table-total">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Hiện tại (m3/h)</th>
                                            <th>Tổng (m3)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Gas</td>
                                            <td id="gas_now">@ViewBag.gas.luu_luong_hien_tai</td>
                                            <td id="gas_total">@ViewBag.gas.luu_luong_tong</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div> <!-- end card-body -->
                    </div> <!-- end card-->
                </div> <!-- end col-->

                <div class="col-xl-6 col-md-6">
                    <div class="card bg-card">
                        <h5 class="card-header text-center font-20">WATER</h5>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0 table-total">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Hiện tại (m3/h)</th>
                                            <th>Tổng (m3)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Water</td>
                                            <td id="water_now">@ViewBag.water.luu_luong_hien_tai</td>
                                            <td id="water_total">@ViewBag.water.luu_luong_tong</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div> <!-- end card-body -->
                    </div> <!-- end card-->
                </div> <!-- end col-->

                <div class="col-xl-6 col-md-6">
                    <div class="card bg-card">
                        <h5 class="card-header text-center font-20">SNACK FACTORY ENERGY</h5>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered mb-0 table-total">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th>Total KW</th>
                                            <th>Total KWh</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>LP-SNACK-1</td>
                                            <td id="kenh2_ptotal">@ViewBag.kenh2.Ptotal</td>
                                            <td id="kenh2_kwh">@ViewBag.kenh2.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>LP-SNACK-2</td>
                                            <td id="kenh3_ptotal">@ViewBag.kenh3.Ptotal</td>
                                            <td id="kenh3_kwh">@ViewBag.kenh3.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>LP-SNACK-3</td>
                                            <td id="kenh1_ptotal">@ViewBag.kenh1.Ptotal</td>
                                            <td id="kenh1_kwh">@ViewBag.kenh1.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>DP-SNACK-1</td>
                                            <td id="kenh5_ptotal">@ViewBag.kenh5.Ptotal</td>
                                            <td id="kenh5_kwh">@ViewBag.kenh5.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>DP-SNACK-2</td>
                                            <td id="kenh4_ptotal">@ViewBag.kenh4.Ptotal</td>
                                            <td id="kenh4_kwh">@ViewBag.kenh4.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>DP-SNACK-3</td>
                                            <td id="kenh6_ptotal">@ViewBag.kenh6.Ptotal</td>
                                            <td id="kenh6_kwh">@ViewBag.kenh6.Kwh</td>
                                        </tr>
                                        <tr>
                                            <td>Total</td>
                                            <td id="total_kw">@ViewBag.count_Ptotal</td>
                                            <td id="total_kwh">@ViewBag.count_Kwh</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div> <!-- end card-body -->
                    </div> <!-- end card-->
                </div> <!-- end col-->

            </div>
        </div> <!-- container -->

    </div> <!-- content -->

</div>
<footer class="footer">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <span class="font-16">Energy from: <strong>20/09/2020</strong></span>
            </div>
        </div>
    </div>
</footer>
<!-- ============================================================== -->
<!-- End Page content -->
<!-- ============================================================== -->
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="~/Content/js/vendor.min.js"></script>
<script src="~/Content/libs/jquery-sparkline/jquery.sparkline.min.js"></script>
<script src="~/Content/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="~/Content/libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-world-mill-en.js"></script>

<!-- Dashboard 2 init -->
<script src="~/Content/js/pages/dashboard-2.init.js"></script>
<!-- App js-->
<script src="~/Content/js/app.min.js"></script>

<script type="text/javascript">
    var myVar;
    $(document).ready(function () {
        clearInterval(myVar);
        myVar = setInterval(function () {
            data_hienthi = getOverviewData();
            if (data_hienthi) {
                $('#gas_now').html(data_hienthi[0].luu_luong_hien_tai);
                $('#gas_total').html(data_hienthi[0].luu_luong_tong);
                $('#water_now').html(data_hienthi[1].luu_luong_hien_tai);
                $('#water_total').html(data_hienthi[1].luu_luong_tong);
                var data_kenh = data_hienthi[2]||[];
                var total_kw = data_hienthi[3] || 0;
                var total_kwh = data_hienthi[4] || 0;
                if (data_kenh) {
                    for (i = 0; i < data_kenh.length; i++) {
                        switch (data_kenh[i].Kenh) {
                            case "1":
                                $('#kenh1_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh1_kwh').html(data_kenh[i].Kwh);
                                break;
                            case "2":
                                $('#kenh2_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh2_kwh').html(data_kenh[i].Kwh);
                                break;
                            case "3":
                                $('#kenh3_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh3_kwh').html(data_kenh[i].Kwh);
                                break;
                            case "4":
                                $('#kenh4_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh4_kwh').html(data_kenh[i].Kwh);
                                break;
                            case "5":
                                $('#kenh5_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh5_kwh').html(data_kenh[i].Kwh);
                                break;
                            case "6":
                                $('#kenh6_ptotal').html(data_kenh[i].Ptotal);
                                $('#kenh6_kwh').html(data_kenh[i].Kwh);
                                break;
                            default:
                                break;
                        }
                        //total_kw += parseFloat(data_kenh[i].Ptotal);
                        //total_kwh += parseFloat(data_kenh[i].Kwh);
                    }
                    $('#total_kw').html(total_kw);
                    //if (total_kwh > 100000) {
                    total_kwh = Math.round((total_kwh / 1000) * 10) / 10;
                    $('#total_kwh').html(total_kwh + " MWh");
                    //}
                    //else {
                    //    $('#total_kwh').html(total_kwh);
                    //}
                    
                }
            }
        }, 1000);
    });
    
    function getOverviewData() {
        var hienthi_data = {};
        $.ajax({
            url: '/Home/GetOverViewData/',
            type: 'get',
            async: false,
            success: function (data) {
                hienthi_data = data;
            },
            error: function (xhr, ajaxOptions, thrownError) {
                var errorMsg = 'Ajax request failed: ' + xhr.responseText;
                $('#content').html(errorMsg);
            }
        });
        return hienthi_data;
    }

    
</script>
